---
layout: default
title: Progress
---

<style>
  .exercise-selector {
    margin-bottom: 2rem;
  }

  .exercise-selector select {
    padding: 0.5rem 1rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 4px;
    min-width: 250px;
  }

  .charts-container {
    display: grid;
    gap: 2rem;
  }

  .chart-wrapper {
    background: #fff;
    border: 1px solid #eee;
    border-radius: 8px;
    padding: 1rem;
  }

  .chart-wrapper h3 {
    margin-top: 0;
    margin-bottom: 1rem;
    font-size: 1.1rem;
    color: #333;
  }

  .no-data {
    text-align: center;
    padding: 2rem;
    color: #666;
  }

  .exercise-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: #f8f8f8;
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
  }

  .stat-card .value {
    font-size: 1.5rem;
    font-weight: bold;
    color: #333;
  }

  .stat-card .label {
    font-size: 0.85rem;
    color: #666;
    margin-top: 0.25rem;
  }
</style>

<h1>Progress Tracker</h1>

<div class="exercise-selector">
  <label for="exercise-select">Select Exercise: </label>
  <select id="exercise-select">
    <option value="">-- Choose an exercise --</option>
  </select>
</div>

<div id="stats-container" class="exercise-stats" style="display: none;">
  <div class="stat-card">
    <div class="value" id="stat-sessions">-</div>
    <div class="label">Sessions</div>
  </div>
  <div class="stat-card">
    <div class="value" id="stat-max-weight">-</div>
    <div class="label">Max Weight (lbs)</div>
  </div>
  <div class="stat-card">
    <div class="value" id="stat-max-volume">-</div>
    <div class="label">Max Volume (lbs)</div>
  </div>
  <div class="stat-card">
    <div class="value" id="stat-total-sets">-</div>
    <div class="label">Total Sets</div>
  </div>
</div>

<div class="charts-container">
  <div class="chart-wrapper">
    <h3>Weight Progression (Max per Session)</h3>
    <canvas id="weightChart"></canvas>
  </div>

  <div class="chart-wrapper">
    <h3>Volume Progression (Total Weight x Reps per Session)</h3>
    <canvas id="volumeChart"></canvas>
  </div>
</div>

<div id="no-data" class="no-data" style="display: none;">
  <p>Select an exercise to view your progress.</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const BASE_URL = '/training_log';
  let weightChart = null;
  let volumeChart = null;

  // Load exercise index and populate dropdown
  async function loadExerciseIndex() {
    try {
      const response = await fetch(`${BASE_URL}/index.json`);
      const exercises = await response.json();

      const select = document.getElementById('exercise-select');
      exercises.forEach(exercise => {
        const option = document.createElement('option');
        option.value = exercise.slug;
        option.textContent = exercise.title;
        select.appendChild(option);
      });
    } catch (error) {
      console.error('Failed to load exercise index:', error);
    }
  }

  // Load exercise data and render charts
  async function loadExerciseData(slug) {
    if (!slug) {
      document.getElementById('stats-container').style.display = 'none';
      document.getElementById('no-data').style.display = 'block';
      clearCharts();
      return;
    }

    try {
      const response = await fetch(`${BASE_URL}/${slug}.json`);
      const data = await response.json();

      document.getElementById('no-data').style.display = 'none';
      document.getElementById('stats-container').style.display = 'grid';

      renderCharts(data);
      updateStats(data);
    } catch (error) {
      console.error('Failed to load exercise data:', error);
    }
  }

  function updateStats(data) {
    const log = data.log;

    // Sessions count
    document.getElementById('stat-sessions').textContent = log.length;

    // Max weight ever lifted
    let maxWeight = 0;
    let totalSets = 0;
    let maxVolume = 0;

    log.forEach(session => {
      let sessionVolume = 0;
      session.sets.forEach(set => {
        maxWeight = Math.max(maxWeight, set.weight);
        totalSets++;
        sessionVolume += set.weight * set.reps;
      });
      maxVolume = Math.max(maxVolume, sessionVolume);
    });

    document.getElementById('stat-max-weight').textContent = maxWeight;
    document.getElementById('stat-max-volume').textContent = maxVolume.toLocaleString();
    document.getElementById('stat-total-sets').textContent = totalSets;
  }

  function clearCharts() {
    if (weightChart) {
      weightChart.destroy();
      weightChart = null;
    }
    if (volumeChart) {
      volumeChart.destroy();
      volumeChart = null;
    }
  }

  function renderCharts(data) {
    clearCharts();

    // Sort log by date ascending for charts
    const sortedLog = [...data.log].sort((a, b) => a.date.localeCompare(b.date));

    const dates = sortedLog.map(entry => entry.date);

    // Calculate max weight per session
    const maxWeights = sortedLog.map(entry => {
      return Math.max(...entry.sets.map(set => set.weight));
    });

    // Calculate total volume per session (sum of weight * reps)
    const volumes = sortedLog.map(entry => {
      return entry.sets.reduce((sum, set) => sum + (set.weight * set.reps), 0);
    });

    const chartOptions = {
      responsive: true,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        x: {
          grid: {
            display: false
          }
        },
        y: {
          beginAtZero: false
        }
      }
    };

    // Weight chart
    const weightCtx = document.getElementById('weightChart').getContext('2d');
    weightChart = new Chart(weightCtx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'Max Weight (lbs)',
          data: maxWeights,
          borderColor: '#4CAF50',
          backgroundColor: 'rgba(76, 175, 80, 0.1)',
          fill: true,
          tension: 0.3,
          pointRadius: 5,
          pointHoverRadius: 8
        }]
      },
      options: chartOptions
    });

    // Volume chart
    const volumeCtx = document.getElementById('volumeChart').getContext('2d');
    volumeChart = new Chart(volumeCtx, {
      type: 'line',
      data: {
        labels: dates,
        datasets: [{
          label: 'Volume (lbs)',
          data: volumes,
          borderColor: '#2196F3',
          backgroundColor: 'rgba(33, 150, 243, 0.1)',
          fill: true,
          tension: 0.3,
          pointRadius: 5,
          pointHoverRadius: 8
        }]
      },
      options: chartOptions
    });
  }

  // Event listener for exercise selection
  document.getElementById('exercise-select').addEventListener('change', (e) => {
    loadExerciseData(e.target.value);
  });

  // Initialize
  loadExerciseIndex();
</script>
